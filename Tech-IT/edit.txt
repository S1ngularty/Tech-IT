<?php 
include("../includes/config.php");
include('../structure/Header.html');
include('../structure/sidebar.html');

if(isset($_SESSION['user_id'])){
$sql="SELECT *  FROM account inner join user using(user_id)";
$result=mysqli_query($conn,$sql);

$action='view';

if(mysqli_affected_rows($conn)>0){
    print "<body> <div class='container'> <div class='table_div'>  <form action='edit.php' method='post'>
    <label for='action' id='action_label'>Action:</label>
  <table width='50%' cellpadding='6' class='table'>
    <tr>
    <th>Customer ID</th>
    <th>Full Name</th>
    <th>Account</th>
    <th>Role</th>
    <th>Action</th>
    </tr>";

      if(isset($_POST['action'])){ 
        $action=$_POST['action'];
      if(isset($_POST['action']) && $_POST['action']==='role' ){
        $admin_check='admin' ;
        $user_check='user';
        while($row= mysqli_fetch_assoc($result)){
          print "<tr>
          <td>{$row['account_id']}</td><td>{$row['first_name']}</td><td>{$row['username']}</td>
          <td>{$row['role']}</td><td><input type='radio' name='admin_radio' value='admin' onclick='this.form.submit()'".($row['role']=='admin'? 'checked': '')."><label>Admin</label>
        <input type='radio' name='user_radio' value='user' onclick='this.form.submit()'".($row['role']=='user'? 'checked': '')."><label>User</label></td>";
              }
      }else{
        $element= "<button class='btn btn-primary' name='account_action' value='$action'>$action</button>";
        while($row= mysqli_fetch_assoc($result)){
          print "<tr>
          <td>{$row['account_id']}</td><td>{$row['first_name']}</td><td>{$row['username']}</td>
          <td>{$row['role']}</td><td>$element</td>";
              }
      }
      }
    print "</table>
     <div class='select_div'>
    <select id='action' name='action' onchange='this.form.submit()' class='form-control'>
    <option value='view'".($action==='view' ? 'selected' :'')." >View</option>
    <option value='edit'".($action==='edit' ? 'selected' :'')." >Edit</option>
    <option value='role'".($action==='role' ? 'selected' :'').">Role</option>
    <option value='delete'".($action==='delete' ? 'selected' :'').">Delete</option>
    </select>
    </div>
    </form></div></div></body>";
}
?>
<style>
      body .container{
   grid-area: 2/5/7/15;
   display: grid;
   gap: 10px;
   padding: 0%;
grid-template-columns: 100px 100px 100px 100px 100px 100px 100px 100px 100px 100px;
grid-template-rows: 100px 100px 100px 100px 100px 50px;
      }

      .table_div{
        grid-area: 1/1/7/11;
      }

      tr{
        text-align: center;
      }

      .select_div{
        grid-area:1/2/2/3 ;
      }

      #action_label{
        grid-area:1/1/2/2 ;
        display: flex;
        justify-content:start ;
      }

      form{
        width: 100%;
        height: 100%;
      }

      .table_div{
        grid-area: 2/1/3/10;
      }
</style>

<?php 



}

?>